# 组合投资理论基础

## 单期，多期收益率，连续复利

https://zhuanlan.zhihu.com/p/514862524

https://www.zhihu.com/column/c_1335724136769540096

如果把一段时间内每一期的资产价格按照时间先后顺序排列起来，将得到资产价格的时间序列。第一期为P1，后续为P2等。假设投资者在t-1时投某资产，投入价格为Pt-1，持有一期后以Pt的价格卖掉。不考虑交易成本，其单期收益率Rt的计算公式为：

<img src=https://pic2.zhimg.com/80/v2-00bdd267e1dccaa97fcc824efbe5b1ed_720w.webp width=30% />


* 多期简单收益率

根据上面公式，二期的单期收益率Rt(2)为：

<img src=https://pic3.zhimg.com/80/v2-785ad915adbdf911c319e8d2d25fc126_720w.webp width=30% />

推导下来，多期简单收益率则为：

若投资者在t-k期以价格Pt-k买入该资产，在t期卖出，则k期单期收益率Rt(k)为：

<img src=https://pic3.zhimg.com/80/v2-1aff916f31ddc34c724eea356650fb06_720w.webp width=30% />



* 单期与多期简单收益率的关系

以两期的简单收益率为例，可以将其分解为两个单期简单收益率的乘积的形式。
<img src=https://pic1.zhimg.com/80/v2-0d70aca1f732fc7dfbfc68d3f0148c60_720w.webp width=30% />

其中 （1+Rt）*(1+Rt-1) 的概念就是复利。

* 平均收益率

而如果不考虑复利，也就是说每一期获得的收益都没有再投入资产中的收益就是简单的单期收益加总。

$$ R_t(k)=\sum_{j=0}^{k-1}{R_{t-j}} $$ 

如果只知道多期收益，要计算单期收益率的平均值，并且不考虑复利，那么公式为：

$$ 算术平均收益率=\frac{R_t(k)}{k}=\frac{\sum_{j=0}^{k-1}{R_{t-j}}}{k} $$

如果只知道多期收益，要计算单期收益率的平均值，并且考虑复利，那么公式为：

$$ 几何平均收益率 = \sqrt[k]{R_t(k)+1}-1=\sqrt[k]{\prod_{j=0}^{k-1}(1+R_{t-j})}-1 $$

* 七日年化

七日年化收益率是货币基金最近7日的平均收益水平，进行年化以后得出的数据；7日年化收益率上显示的收益率是年化收益率，也就是说投资这款理财产品一年可以获得的收益。

* 连续复利收益率

单期与多期连续复利收益率的关系
我们以两期连续复利收益率为例，两期连续复利收益率等于前一天和当天的单期复利收益

率之和。进而推知，k期连续复利收益率为k天的单期连续复利收益率之和。这体现了连续

复利收益率的优良性质：单期加总得到多期。
<img src=https://pic4.zhimg.com/80/v2-da9072b4cb2dc03a8a8985cf50167e37_720w.webp width=30% />

# 资产风险的测度


## 风险与方差

Markowitz首先提出来用方差来度量风险。单个资产的风险具体可以表达为：

$$ \sigma^2(R)=E\{[R-E(R)]^2\} $$

其中，R是所有可能发生的（或者已经实现的）收益率（随机变量），E（R）表示预期收益率。若收益率R是离散分布，则：

$$ \sigma^2(R)=\sum_{K}{p_k[R_k-E(R)]} $$

方差风险度量法观念简单，容易理解，但是也有一些弊端。比如这一定义偏离了风险的本意，风险往往认为是潜在的损失，而方差是一个中性的概念，只有向下的波动才和风险本义相契合，向上的波动反而会让投资者获益，无法反应风险的经济性质。并且Markowitz在构建均值-方差投资组合时，将收益率看成服从正态分布，这是一个重要假设，这样才能忽略收益率的偏度和峰度等统计特性，只需考虑均值、方差即可，但实际上很多产品的收益率是不满足正态分布的，具有明显的偏度和峰度，继续使用方差度量风险可能会带来较大的误差。


## 下行风险

在Markowitz之后，Roy于1952年提出了用下行偏差（Downside Deviation）来度量风险的办法。下行偏差法和方差法类似，不过更贴近现实中投资者对风险的理解（只考虑低于目标收益率的变动）。计算下行偏差时，一个最重要的变量就是目标收益率，通常用可接受的最低收益率（Minimum Acceptable Rate of Return，MARR）来表示，MARR可以是无风险利率或者0，或者资产收益率的平均值。下行偏差描述的是低于MARR的收益率的发散程度，总体的下行偏差公式如下：

$$ \delta（R, MARR）=\sqrt{E\{[min(R-MARR,0)]^2\}} $$
若我们有R1，R2，...，RT作为R的随即样本，则样本额下行偏差为：

$$ \delta（R, MARR）=\sqrt{\frac{1}{T}\sum_{t=1}^{T}\{[min(R-MARR,0)]^2\}} $$

用下行偏差描述的风险称为下行风险（Downside Risk）

## 最大回撤

实务上经常会用最大回撤（Maximum Drawdown，MDD）来衡量投资（特别是基金，股票投资组合）的表现，在介绍最大回撤前，我们先来了解下什么是回撤。某资产（或投资组合）在时刻T的回撤是指资产在（0，T）的最高峰值与现在价格 
 之间的回落值，用数学公式表达为：
 
$$ D(T)=max\{0,max_{t\in(0,T)}\{P_t-P_T\}\} $$
 
 对应的回撤率为：
 
$$ d(T)=\frac{D(T)}{max_{t\in(0,T)}P_t} $$
 
知晓回撤的含义，最大回撤就比较好理解了，资产在T时刻的最大回撤就是资产在（0，T）时段内回撤的最大值。直观地说就是这一时段内，资产价值从最高峰回落到最低谷的幅度。最大回撤通常用来描述投资者在持有资产时可能面临的最大亏损。

## 投资组合的收益率

在拓展到N中风险资产之前，先来看两种资产的情况。假设现在市场有资产A和资产B，其随机收益率分别为 
$R_A$和$R_B$,若投资人将其财富的一部分投入资产A，剩下的全部投入资产B，投资比例分别为$\omega_A$和$\omega_B$
我们就可以求得投资组合的收益率  ，就是总收益除以初始资本

$$ R_p = {\omega_AR_A+\omega_BR_B} $$
$$\omega_A+\omega_B=1$$


## 投资组合的风险

资产风险的衡量我们上一节讲过了，这里我们还沿用收益率的方差来指代风险。单个资产收益率的方差为：

$$ \sigma^2(R_i)=E\{[R_i-E(R_i)]^2\ $$

两个资产组成的投资组合的方差为：

$$ \sigma^2(R_p)=E\{[R_p-E(R_p)]^2\} $$

$$ =E\{[\omega_AR_A+\omega_BR_B-E(\omega_AR_A+\omega_BR_B)]^2\} $$

$$ =E\{\{\omega_A[R_A-E(R_A)])+\omega_B[R_B-E(R_B)]\}^2\} $$

$$ =E\{\omega^2_A[R_A-E(R_A)]^2)+\omega^2_B[R_B-E(R_B)]^2+2\omega_A\omega_B[R_A-E(R_A)][R_B-E(R_B)]\} $$

$$ =\omega^2_A\sigma^2(R_A)+\omega^2_B\sigma^2(R_B)+2\omega_A\omega_B\sigma(R_A,R_B) $$

其中 $ \sigma(R_A,R_B) $为资产A与资产B的协方差，也可以写作 $ Cov（R_A,R_B）$ 
$$ Cov(R_A,R_B)=E\{[R_A-E(R_A)][R_B-E(R_B)]\} $$

从上式可以看出，如果资产A与资产B收益率变化趋势一致（你为正，我也为正），那么协方差为正；反之（我赚了，你赔了）则为负。所以协方差也就是描述两个变量有多大的“可能”朝一个方向改变，但是协方差会受比例影响，比如A扩大十倍收益率，B扩大十倍收益率，那么协方差会扩大100倍。还有就是相关系数，更能刻画两者的相关度。相关系数和协方差的关系如下关系式：

$$ \rho(A,B)=\frac{\sigma(R_A,R_B)}{\sigma(R_A)\sigma(R_B)} $$

当把两个投资组合推广到n个投资组合的时候，我们就得到了如下公式：

$$ \sigma^2(R_p)=\sigma^2(\sum_{i=1}^{N}{\omega_iR_i})=\sum_{i=1}^{N}{\omega_i^2\sigma^2(R_i)}+\sum_{i\ne j}{\omega_i\omega_j\sigma(R_i,R_j)} $$

## 夏普比率与最佳投资组合

夏普比率（ Sharpe ratio），是指投资组合）在对其调整风险后，相对于无风险资产的表现。

它代表投资者额外承受的每一单位风险所获得的超额收益。对一个投资组合而言，夏普比率越高越好。
夏普比率 = (回报率 – 无风险利率)/标准差


假设目前投资一个预期回报率为12%，波动率（标准差）为10%的投资组合。无风险利率是5%。
夏普比率就是：

$$ (Ra−Rf)/ σa = (0.12−0.05) /0.1 = 0.7 $$

一般来说单纯买入并持有指数，例如持有标普500指数，夏普率大约在0.5左右，而经过资产配置后的投资组合，夏普率通常可以得到提升，如果是接近1，就是不错的策略，如果是1.5以上那就非常优秀了。

## CAPM

https://zhuanlan.zhihu.com/p/366322544

在20世纪60年代，三位学者Sharpe（1964），Lintner（1965），Mossin（1966）在Markowitz模型框架下不约而同推导除了奠定现代投资学的经典模型：资本资产定价模型（Capital asset pricing model，CAPM）。三位学者经过严格的推导都得出以下结论：对于任意的资产组合，其收益率 满足以下关系式：

$$ E(R_q)-R_f=\beta_{qm}[E(R_m)-R_f] $$

该公式被称为传统的CAPM应模型，其中：Rm是市场投资组合之收益率，该组合是市场上所有风险资产的组合，包括股票等金融资产，也包括黄金等实物资产，在现实中构建这样的投资组合时不大可能实现的，因此在实务中常常以大盘指数来替代市场投资组合，根据大盘指数计算出来的收益率被看做Rm

$$ \beta_{qm}=\frac{\sigma(R_q,R_m)}{\sigma^2(R_m)} $$
为投资组合q的beta值，其中分母为资产组合收益率与市场投资组合收益率的协方差， 
分子为市场投资组合的方差，beta贝塔值反映出资产组合q的系统性风险；如果拟采用大盘指数来计算Rm，那么系统性风险那就是大盘的涨跌。


E(R_q)-R_f为风险投资组合q比无风险利率高出的期望收益率，高出来的部分是因为投资人在持有风险组合q时，承担了更多的风险，因此E(R_q)-R_f被称为风险溢价（Risk Premium）。

CAPM中的投资组合q可以是任意投资组合，也可以是单只股票，单只股票我们用小写i表示，那么就可以得到单只股票的CAPM公式
$$ E(R_q)=R_f+\beta_{qm}[E(R_m)-R_f] $$


其中的$\beta_{qm}$可以反映出单个资产的系统风险水平，若等于1，则资产i的价格和市场投资组合的价格波动性是一样的。如果小于1，则资产i的价格波动程度小于市场投资组合的；若大于1，则资产i的波动性更大。值为正就说明资产i的价格和市场投资组合价格变动同方向，反之则相反变动。

CAPM模型说明，单只股票的期望收益是无风险收益加上系统性风险溢价，非系统性风险可以通过分散化投资消除，所以没有对应的风险溢价。



CAPM公式中个股和大盘的收益率都是期望值，Jenson（1968）在研究共同基金表现时将CAPM模型写成如下形式：

$$ E(R_{it})-R_{ft}=\alpha_i+\beta_{i}[E(R_{mt})-R_{ft}]+\varepsilon_{it} $$

进行实证分析，$ R_{it},R_{ft},R_{mt}$
 对应的是个股i、无风险资产（通常是银行存款、国债）、市场指数（大盘指数）的收益率之时间序列资料，对这些资料进行线性回归分析，得到未知参数alpha和beta的估计值 
 。式子中的alpha是由Jenson引入的，所以又被称为Jenson's Alpha。根据CAPM模型之假设， 
 $ R_{it}$是服从正态分布的随机数，这样就可以判断 alpha和beta
 之统计显著性。 
 可以解释个股过去的收益率与风险之间的关系， 
 表示收益率胜过大盘的部分，通常也用来衡量基金经理的绩效。现在所有的投资者在做的事情都可以用一句话来概括，就是试图运用各种方法创造显著的正阿尔法。这些方法包括：基本面分析，消息面分析，技术面分析和阿尔法策略。

阿尔法策略的重点在于通过构建投资组合对冲掉系统风险，锁定alpha超额收益。若在有卖空机制的市场，对冲投资组合比较好构建。首先明确整个投资组合的资金，然后确定出具有较高alpha收益的、需要最多的证券组合和具有市场指数特征、用来对冲掉系统风险的、需要做空的证券组合，其次分配好资金的比重，最终获得稳定的Alpha收益率。另外也可以用证券和股指期货结合进行操作，比如投资者预测出未来会跑赢大盘的证券，则可以在证券市场将其买入，同时在期货市场卖空股指期货合约，以对冲系统性风险，这样市场的涨跌不会影响到投资组合的收益率。

